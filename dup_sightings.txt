




CREATE TABLE dup_sightings (id INT, created TIMESTAMP, shape VARCHAR(256), duration int, description VARCHAR(2048), city_id INT, state_id INT, county_id INT);

WITH duples AS
(SELECT created, shape, duration, description, city_id, state_id, county_id from sightings
GROUP BY created, shape, duration, description, city_id, state_id, county_id HAVING count(*) > 1)
INSERT INTO dup_sightings (id, created, shape, duration, description, city_id, state_id, county_id)
SELECT s.id, s.created, s.shape, s.duration, s.description, s.city_id, s.state_id, s.county_id FROM sightings s
JOIN duples d ON s.created = d.created AND s.shape = d.shape AND s.duration = d.duration AND s.description = d.description
AND s.city_id = d.city_id AND s.state_id = d.state_id AND s.county_id = d.county_id;

DELETE FROM sightings WHERE id in (select id from dup_sightings);

INSERT INTO sightings (created, shape, duration, description, city_id, state_id, county_id)
SELECT (created, shape, duration, description, city_id, state_id, county_id) FROM dup_sightings
GROUP BY create, shape, duration, description, city_id, state_id, county_id;

SELECT count(*) FROM dup_sightings;
SELECT count(*) FROM dup_sightings GROUP BY create, shape, duration, description, city_id, state_id, county_id;

